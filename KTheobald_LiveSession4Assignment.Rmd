---
title: "Harry Potter and ESPN Spurs Player Stats"
author: "Kari Theobald"
date: "2/1/2019"
output:
  html_document:
    keep_md: yes
  pdf_document: default
---

## R Markdown

## Github Directory : https://github.com/TheobaldK/MSDS-6306-Homework.git

##__Question 1__

###	a. In the IMDB, there are listings of full cast members for movies. Navigate to http://www.imdb.com/title/tt1201607/fullcredits?ref_=tt_ql_1. Feel free to View Source to get a good idea of what the page looks like in code. The packages installed are:  install.packages("imdbapi") , install.packages("rvest"), install.packages("tidyr"), install.packages("RCurl").

```{r, echo=TRUE, cache=TRUE}  
### Install the following libraries.
library(XML)
library(jsonlite)
library(RJSONIO)
library(RCurl)
library(imdbapi)
library(stringr)
library(rvest)
library(tidyr)
```

###	b. Scrape the page with any R package that makes things easy for you. Of particular interest is the table of the Cast in order of crediting. Please scrape this table (you might have to fish it out of several of the tables from the page) and make it a data.frame() of the Cast in your R environment The xpath from the wesbite is :  //*[@id="fullcredits_content"]/table[3]

```{r, echo=TRUE, cache=TRUE}  
# Go to the IMDb website. 
website<-"https://www.imdb.com/title/tt1201607/fullcredits?ref_=tt_ql_1"
# Assign the website the data.frame Actor. Use the Xpath pull drom the website where the table for the Full Credits are on the Cast. 
Actor<-website %>% html() %>% html_nodes(xpath = '//*[@id="fullcredits_content"]/table[3]') %>% html_table()
# Make the table import into the Actor data frame. 
Actor <- Actor [[1]]
```

###	c. Clean up the table It should not have blank observations or rows, a row that should be column names, or just ‘…’  It should have intuitive column names (ideally 2 to start – Actor and Character)  In the film, Mr. Warwick plays two characters, which makes his row look a little weird. Please replace his character column with just “Griphook / Professor Filius Flitwick” to make it look better.  One row might result in “Rest of cast listed alphabetically” – remove this observation. 

```{r, echo=TRUE, cache=TRUE}
# Clean our data frame. 
# Rename the table column names as Number, Cast, Spacer for "...", Role.
colnames(Actor)<-c("Number", "Cast", "Spacer", "Role")
# Take out the first row in the data frame Actor. 
Actor <- Actor[-c(1),]
# Remove all the \n characters. 
Actor$Role<-str_replace_all(Actor$Role, "[\n]", "")
# Remove the Number and Spacer column from the Actor data frame and then call it ActorINfo. 
ActorInfo<-subset(Actor, select= -c(Number, Spacer))
# In row 10 and 22 adjust the names in these columns where they are together. 
ActorInfo$Role[10] <- "Griphook / Professor Filius Flitwick"
ActorInfo$Role[22] <- "Hogsmeade Death Eater / (as Benjamin Northover)"
# In row 92 remove the row as it shows "Rest of cast listed alphabetically. 
ActorInfo<- ActorInfo[-c(92),]
head(ActorInfo, 10)
```
###	d. Split the Actor’s name into two columns: FirstName and Surname. Keep in mind that some actors/actresses have middle names as well. Please make sure that the middle names are in the FirstName column, in addition to the first name (example: given the Actor Frank Jeffrey Stevenson, the FirstName column would say “Frank Jeffrey.”) 

```{r, echo=TRUE, cache=TRUE}
#Separate the First from Last Name on the Actor Names.
ActorInfoSplit<-extract(ActorInfo, Cast, c("FirstName", "LastName"), "([^ ]+) (.*)")
#Clean up the names to make Middle Name or Initial with the First Name. 
ActorInfoSplit$FirstName[12]<- "Helena Bonham"
ActorInfoSplit$LastName[12]<- "Carter"
ActorInfoSplit$FirstName[36]<- "Sian Grace"
ActorInfoSplit$LastName[36]<- "Phillips"
ActorInfoSplit$FirstName[78]<-"Peter G."
ActorInfoSplit$LastName[78]<-"Reed"
ActorInfoSplit$FirstName[81]<-"Bob Yves"
ActorInfoSplit$LastName[81]<-"Van Hellenberg Hubar"
ActorInfoSplit$LastName[86]<-"De Beistegui"
ActorInfoSplit$FirstName[95]<-"Michael Henbury"
ActorInfoSplit$LastName[95]<-"Ballan"
ActorInfoSplit$FirstName[106]<-"Gioacchino Jim"
ActorInfoSplit$LastName[106]<-"Cuffaro"
ActorInfoSplit$FirstName[112]<-"Grace Meurisse"
ActorInfoSplit$LastName[112]<-"Francis"
ActorInfoSplit$FirstName[113]<-"Sean Francis"
ActorInfoSplit$LastName[113]<-"George"
#Name the columns as FirstName, Surname, Character. We are no longer using the word Role.
colnames(ActorInfoSplit)<-c("FirstName", "Surname", "Character")
```

###	e. Present the first 10 rows of the data.frame() – It should have only FirstName, Surname, and Character columns. 

```{r, echo=TRUE, cache=TRUE}
#Show the top 10 lins of the data frame ActorInfoSplit
head(ActorInfoSplit, 10)
```

##__Question 2__

###a. On the ESPN website, there are statistics of each NBA player. Navigate to the San Antonio Spurs current statistics (likely http://www.espn.com/nba/team/stats/_/name/sa/san-antonio-spurs). You are interested in the Shooting Statistics table.  We find the table to the for the Xpath is : //*[@id="fittPageContainer"]/div[2]/div[5]/div[1]/div/article/div/section/section/section[2]/table

###	b. Scrape the page with any R package that makes things easy for you. There are a few tables on the page, so make sure you are targeting specifically the Shooting Statistics table.

```{r, echo=TRUE, cache=TRUE}
# We pull the data from the ESPN website. We are Call the data frame we are building Shooting.Stats and we made th fill=TRUE. 
library("rvest")
web.espn<-("http://www.espn.com/nba/team/stats/_/name/sa/san-antonio-spurs")
Shooting.Stats<-web.espn %>% html() %>%  html_nodes(xpath='//*[@id="fittPageContainer"]/div[2]/div[5]/div[1]/div/article/div/section/section/section[2]/table') %>% html_table(fill = TRUE)
Shooting.Stats <- Shooting.Stats [[1]]
```
	
### c. Clean up the table (You might get some warnings if you’re working with tibbles)  You’ll want to create an R data.frame() with one observation for each player. Make sure that you do not accidentally include blank rows, a row of column names, or the Totals row in the table as observations.  The column PLAYER has two variables of interest in it: the player’s name and their position, denoted by 1-2 letters after their name. Split the cells into two columns, one with Name and the other Position.  Check the data type of all columns. Convert relevant columns to numeric. Check the data type of all columns again to confirm that they have changed! 

```{r, echo=TRUE, cache=TRUE}


#Take the 1st column in the data frame Shooting.Stats and remove line 1,2,18:36 column as this will give us in the Athlete.names.
Athlete.names<-Shooting.Stats$X1[-c(1, 2,18:36)]
# Take the 3rd column in the data frame Shooting Stats and remove all the na's and call it FG.Percent for Field Gold Percent. 
FG.Percent<-Shooting.Stats$X3[!is.na(Shooting.Stats$X3)]  #FG%
FG.Percent<-FG.Percent[-c(1,2,3,19)]
# Remove the na's from the column X2-14 columns and assign them the appropriate title.
FGA<-Shooting.Stats$X2[!is.na(Shooting.Stats$X2)]         #FGA
FGA<-FGA[-c(1,2,3,19)]
Three.PM<-Shooting.Stats$X4[!is.na(Shooting.Stats$X4)]     #3PM
Three.PM<-Three.PM[-c(1,2,3,19)]
Three.PA<-Shooting.Stats$X5[!is.na(Shooting.Stats$X5)]     #3PA
Three.PA<-Three.PA[-c(1,2,3,19)]
ThreeP.Percent<-Shooting.Stats$X6[!is.na(Shooting.Stats$X6)]
ThreeP.Percent<-ThreeP.Percent[-c(1,2,3,19)]
FTM<-Shooting.Stats$X7[!is.na(Shooting.Stats$X7)]    #FTM
FTM<-FTM[-c(1,2,3,19)]
FTA<-Shooting.Stats$X8[!is.na(Shooting.Stats$X8)]    #FTA
FTA<-FTA[-c(1,2,3,19)]   
FT.Percent<-Shooting.Stats$X9[!is.na(Shooting.Stats$X9)]   #FT%
FT.Percent<-FT.Percent[-c(1,2,3,19)]
TwoPM<-Shooting.Stats$X10[!is.na(Shooting.Stats$X10)]     #2PM
TwoPM<-TwoPM[-c(1,2,3,19)]
TwoPA<-Shooting.Stats$X11[!is.na(Shooting.Stats$X11)]     #2A
TwoPA<-TwoPA[-c(1,2,3,19)]
TwoP.Percent<-Shooting.Stats$X12[!is.na(Shooting.Stats$X12)]
TwoP.Percent<-TwoP.Percent[-c(1,2,3,19)]
SC.EFF<-Shooting.Stats$X13[!is.na(Shooting.Stats$X13)]
SC.EFF<-SC.EFF[-c(1,2,3,19)]
SH.Eff<-Shooting.Stats$X14[!is.na(Shooting.Stats$X14)]
SH.Eff<-SH.Eff[-c(1,2,3,19)]
FGM<-Shooting.Stats$X1[!is.na(Shooting.Stats$X1)]
FGM<-FGM[-c(1:20, 36)]  # FGM has extra rows attached, removed row 1:30 and row 36. 

# The last 2 names in for the players have positions. These are labeled as Player.Position.
Player.Position<-c("SG", "C", "SF", "SG", "SG", "PG", "PG", "SF", "C", "C", "SF", "SG", "PF", "PF", "SF")

# Create a data frame with the new objects and call it PlayerStats with the 1st Column Athlete.Names. 
PlayerStats<-data.frame(Athlete.names, Player.Position, FGM, FGA, FG.Percent, Three.PM, Three.PA, ThreeP.Percent, FTM, FTA, FT.Percent, TwoPM, TwoPA, TwoP.Percent, SC.EFF, SH.Eff)

#  Label the columns with appropriate names. 
colnames(PlayerStats)<-c(Ahtlete.names="Names", Player.Position="Position", FGM="FGM", FGA="FGA", FG.Percent="FG%", Three.PM="3PM", Three.PA="3PA",ThreeP.Percent="3P%",FTM="FTM", FTA="FTA", FT.Percent="FT%", TwoPM= "2PM", TwoPA="2PA", TwoP.Percent="2P%", SC.EFF="SC-EFF", SH.Eff="SH.EFF")

# Extract the players position from their names. 
PlayerStats<-extract(PlayerStats, Names, c("First Name", "Position"), "([^ ]+)(.*)")
PlayerStats<-extract(PlayerStats, Position, c("Surname", "PlyrPosition"), "([^ ]+)(.*)")

PlayerStats$PlyrPosition[12]<- "SG"  # Row 12 in the PlyrPosition column  has SG attached with IV so change to SG. 
PlayerStats$Surname[12]<- "Walker IV"   #Row 12 in the PlyrPositiong column has only the Surname, change to add the IV to their name. 

PlayerStats
```
	
### d. Create a colorful bar chart that shows the Field Goals Percentage Per Game for each person. It will be graded on the following criteria. Informative Title, centered Relevant x and y axis labels (not simply variables names!) Human-readable axes with no overlap (you might have to flip x and y to fix that). Note: You do not have to convert the decimal to a percentage. Color the columns by the team member’s position (so, all PF’s should have the same color, etc.) 

```{r, echo=TRUE, cache=TRUE}
library(ggplot2)
par(las=2)
FGPlot<-ggplot(data=PlayerStats, aes(x=Athlete.names,y=PlayerStats$`FG%`, fill=PlyrPosition)) + geom_bar(stat="identity") + xlab("Players") +  ylab("Field Goal Percentage") + ggtitle("Spurs Field Goals Percentage Per Game vs Player") + theme(plot.title = element_text(hjust = 0.5))+ coord_flip()
FGPlot
```

